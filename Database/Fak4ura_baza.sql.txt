-- Projekt bazy Fak4ura
-- SPK / Fak4ura TEAM

ALTER SESSION SET NLS_DATE_FORMAT='YYYY-MM-DD';

DROP TABLE F4_Faktury_pozycje CASCADE CONSTRAINTS;
DROP TABLE F4_Faktury CASCADE CONSTRAINTS;
DROP TABLE F4_Uzytkownicy CASCADE CONSTRAINTS;
DROP TABLE F4_Kontrahenci CASCADE CONSTRAINTS;


CREATE TABLE F4_Uzytkownicy (
    --id        NUMBER GENERATED ALWAYS AS IDENTITY,
    imie      VARCHAR2(30) NOT NULL,
    nazwisko  VARCHAR2(50) NOT NULL,
    nazwa_firmy VARCHAR2(50),
    nazwisko_rodowe VARCHAR(50),
    haslo     VARCHAR2(100)NOT NULL,
    ulica     VARCHAR(50),
    kod_pocztowy VARCHAR(8),
    miejscowosc  VARCHAR(50),
    kraj      VARCHAR(50),
    nr_dokumentu VARCHAR(20),
    typ_dokumentu VARCHAR(7) CONSTRAINT f4_u_td_chk CHECK (typ_dokumentu IN ('DOWOD', 'PASZPORT')),
    email     VARCHAR(60) NOT NULL,
    telefon  VARCHAR(20),
    nip     VARCHAR(20),
    aktywny   NUMBER(1,0) CONSTRAINT f4_u_a_chk CHECK (aktywny IN (0, 1))
);
ALTER TABLE F4_Uzytkownicy ADD CONSTRAINT f4_u_pk PRIMARY KEY ( email );


CREATE TABLE F4_Kontrahenci (
    id        NUMBER GENERATED ALWAYS AS IDENTITY,
    nazwa     VARCHAR2(50) UNIQUE NOT NULL,
    imie      VARCHAR2(30) NOT NULL,
    nazwisko  VARCHAR2(50) NOT NULL,
    ulica     VARCHAR(50),
    kod_pocztowy VARCHAR(8),
    kraj      VARCHAR(50) NOT NULL,
    NIP       VARCHAR(10),
    email     VARCHAR(60),
    www       VARCHAR2(50)
);
ALTER TABLE F4_Kontrahenci ADD (
    CONSTRAINT f4_k_pk PRIMARY KEY ( id )
);


CREATE TABLE F4_Faktury (
    id        NUMBER GENERATED ALWAYS AS IDENTITY,
    numer     VARCHAR(20) UNIQUE NOT NULL,
    data      DATE DEFAULT SYSDATE,
    waluta    VARCHAR(3),
    ilosc_pozycji NUMBER NOT NULL,
    wartosc   NUMBER NOT NULL,
    podatek   NUMBER,
    uzytkownik_login VARCHAR2(20) NOT NULL,
    kontrahent_id NUMBER NOT NULL
);
ALTER TABLE F4_Faktury ADD (
    CONSTRAINT f4_f_pk PRIMARY KEY ( id ),
    CONSTRAINT f4_f_fk_u FOREIGN KEY (uzytkownik_login) REFERENCES F4_Uzytkownicy( email ),
    CONSTRAINT f4_f_fk_k FOREIGN KEY (kontrahent_id) REFERENCES F4_Kontrahenci( id )
);


CREATE TABLE F4_Faktury_pozycje (
    id        NUMBER GENERATED ALWAYS AS IDENTITY,
    nazwa_pozycji VARCHAR2(50) NOT NULL,
    ilosc     NUMBER NOT NULL,
    cena      NUMBER,
    podatek   VARCHAR2(20),
    faktura_id NUMBER NOT NULL
);
ALTER TABLE F4_Faktury_pozycje ADD (
    CONSTRAINT f4_fp_pk PRIMARY KEY ( id ),
    CONSTRAINT f4_fp_fk_f FOREIGN KEY (faktura_id) REFERENCES F4_Faktury( id )
);



