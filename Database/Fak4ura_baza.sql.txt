-- Projekt bazy Fak4ura
-- SPK / Fak4ura TEAM

ALTER SESSION SET NLS_DATE_FORMAT='YYYY-MM-DD';

DROP TABLE F4_Faktury_pozycje CASCADE CONSTRAINTS;
DROP TABLE F4_Faktury CASCADE CONSTRAINTS;
DROP TABLE F4_Uzytkownicy CASCADE CONSTRAINTS;
DROP TABLE F4_Kontrahenci CASCADE CONSTRAINTS;
DROP TABLE F4_temphash CASCADE CONSTRAINTS;


CREATE TABLE F4_Uzytkownicy (
    uzytkownik_id    int  GENERATED ALWAYS as IDENTITY(START with 1 INCREMENT by 1),
    imie      VARCHAR2(30) NOT NULL,
    nazwisko  VARCHAR2(50) NOT NULL,
    nazwa_firmy VARCHAR2(50),
    nazwisko_rodowe VARCHAR(50),
    haslo     VARCHAR2(100)NOT NULL,
    sol VARCHAR2(40) NOT NULL,
    ulica     VARCHAR(50),
    kod_pocztowy VARCHAR(8),
    miejscowosc  VARCHAR(50),
    kraj      VARCHAR(50),
    nr_dokumentu VARCHAR(20),
    typ_dokumentu VARCHAR(7) CONSTRAINT f4_u_td_chk CHECK (typ_dokumentu IN ('DOWOD', 'PASZPORT')),
    email     VARCHAR(60) NOT NULL UNIQUE,
    telefon  VARCHAR(20),
    nip     VARCHAR(30),
    bank  VARCHAR(30),
    numer_konta     VARCHAR(50),
    aktywny   NUMBER(1,0) CONSTRAINT f4_u_a_chk CHECK (aktywny IN (0, 1)),
    logo blob
);
ALTER TABLE F4_Uzytkownicy ADD CONSTRAINT f4_u_pk PRIMARY KEY ( uzytkownik_id );



CREATE TABLE F4_Kontrahenci (
    id        int  GENERATED ALWAYS as IDENTITY(START with 1 INCREMENT by 1),
    uzytkownik_id int NOT NULL,
    nazwa     VARCHAR2(50) UNIQUE NOT NULL,
    imie      VARCHAR2(30) NOT NULL,
    nazwisko  VARCHAR2(50) NOT NULL,
    ulica     VARCHAR(50),
    miejscowosc  VARCHAR(50),
    kod_pocztowy VARCHAR(8),
    kraj      VARCHAR(50) ,
    NIP       VARCHAR(10),
    telefon   VARCHAR(16),
    email     VARCHAR(60),
    www       VARCHAR2(50)
);

ALTER TABLE F4_Kontrahenci ADD (
    CONSTRAINT f4_k_pk PRIMARY KEY ( id )
);

alter table F4_Kontrahenci
add constraint F4_Kontrahenci_fk foreign key (uzytkownik_id) references F4_Uzytkownicy(uzytkownik_id);

CREATE TABLE F4_Faktury (
    id     int  GENERATED ALWAYS as IDENTITY(START with 1 INCREMENT by 1),
    uzytkownik_id NUMBER NOT NULL,
    numer     VARCHAR(20) UNIQUE NOT NULL,
    data_wystawienia      DATE DEFAULT SYSDATE,
    termin_platnosci      DATE ,
    waluta    VARCHAR(3),
    uregulowana VARCHAR(1) NOT NULL,
    wartosc   VARCHAR(15) NOT NULL,
    podatek   VARCHAR(13),
    bank   VARCHAR(25),
    konto   VARCHAR(25),
    forma_platnosci   VARCHAR(15),
    sprzedawca_nazwa VARCHAR2(30) NOT NULL,
    sprzedawca_adres VARCHAR2(25) NOT NULL,
    sprzedawca_miejscowosc VARCHAR2(25) NOT NULL,
    sprzedawca_kod_pocztowy VARCHAR2(8) NOT NULL,
    sprzedawca_nip VARCHAR2(15) NOT NULL,
    sprzedawca_telefon VARCHAR2(20),
    sprzedawca_email VARCHAR2(30),
    nabywca_nazwa VARCHAR2(30) NOT NULL,
    nabywca_adres VARCHAR2(25) NOT NULL,
    nabywca_miejscowosc VARCHAR2(25) NOT NULL,
    nabywca_kod_pocztowy VARCHAR2(8) NOT NULL,
    nabywca_nip VARCHAR2(15) NOT NULL,
    nabywca_telefon VARCHAR2(20),
    nabywca_email VARCHAR2(30),
    logo blob
);
ALTER TABLE F4_Faktury ADD (
    CONSTRAINT f4_f_pk PRIMARY KEY ( id ),
    CONSTRAINT f4_f_fk_u FOREIGN KEY (uzytkownik_id) REFERENCES F4_Uzytkownicy( uzytkownik_id )
   -- CONSTRAINT f4_f_fk_k FOREIGN KEY (kontrahent_id) REFERENCES F4_Kontrahenci( id )
);


CREATE TABLE F4_Faktury_pozycje (
    id      int  GENERATED ALWAYS as IDENTITY(START with 1 INCREMENT by 1),
    nazwa_pozycji VARCHAR2(50) NOT NULL,
    ilosc     VARCHAR2(15) NOT NULL,
    cena      VARCHAR2(20),
    jednostka	VARCHAR2(12),
    podatek   VARCHAR2(20),
    faktura_id NUMBER NOT NULL
);
ALTER TABLE F4_Faktury_pozycje ADD (
    CONSTRAINT f4_fp_pk PRIMARY KEY ( id ),
    CONSTRAINT f4_fp_fk_f FOREIGN KEY (faktura_id) REFERENCES F4_Faktury( id )
);

CREATE TABLE F4_tempHash (
    id int  GENERATED ALWAYS as IDENTITY(START with 1 INCREMENT by 1),
    uzytkownik_id int NOT NULL,
    sol VARCHAR2(40) NOT NULL,
    hash_string VARCHAR2(70) NOT NULL,
    data_utworzenia TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

alter table F4_tempHash
add constraint F4_tempHash_fk foreign key (uzytkownik_id) references F4_uzytkownicy(uzytkownik_id);


